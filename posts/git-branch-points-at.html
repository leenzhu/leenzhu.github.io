<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="leen"><meta name=description content="在使用 git 的时候大部分时候都是通过 git rev-parse &amp;lt;branch-name&amp;gt; 来获取某个分支名对应的 commit id 但是一直没遇到通过 commit id 来获取分支名的场景。在学习 git rebase 命令的时候突然想知道有没有这个命令。于是就开始问 chatgpt 了。
"><meta name=keywords content="git"><link rel=canonical href=https://leenzhu.com/posts/git-branch-points-at.html><title>git 根据commit反查branch、tag名 &#183; Leen Zhu</title><link rel="shortcut icon" href=/image/logo.png><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/chroma.css><link rel=stylesheet href=/scss/sun.min.173be92a65a018529d78026ec3240959d2a3dd35b070c391cad265c861d20173.css integrity="sha256-FzvpKmWgGFKdeAJuwyQJWdKj3TWwcMORytJlyGHSAXM=" crossorigin=anonymous></head><body><div class=main><header class="header clearfix"><a href=/ class=site-logo><img src=/image/logo.png></img></a><div class=site-info><h1 class=site-name><a href=/>Leen Zhu</a></h1><p class=site-description>while(life--) money++;</p></div><nav class=site-nav><a href=/>首页</a>
<a href=/posts.html>归档</a>
<a href=/categories.html>分类</a>
<a href=/tags.html>标签</a>
<a href=/about.html>关于</a></nav></header><div class=content><div class=post-page><div class=print-url>https://leenzhu.com/posts/git-branch-points-at.html</div><h1><a href=/posts/git-branch-points-at.html>git 根据commit反查branch、tag名</a></h1><div class=post-meta><span class=date>2024-05-31</span>
<span class="field tags"><a class=tag href=https://leenzhu.com/tags/git.html>#git</a></span></div><hr><div class=post-content><p>在使用 <code>git</code> 的时候大部分时候都是通过 <code>git rev-parse &lt;branch-name></code> 来获取某个分支名对应的 <code>commit id</code> 但是一直没遇到通过 <code>commit id</code> 来获取分支名的场景。在学习 <code>git rebase</code> 命令的时候突然想知道有没有这个命令。于是就开始问 <code>chatgpt</code> 了。</p><p>最开始，我问 <code>chatgpt</code> ：</p><blockquote><p><code>git rev-pase &lt;branch-name></code> 这个命令可以根据分支名获取对应的commit id，有没有相反的命令：根据commit id获取对应的分支名？</p></blockquote><p><code>chatgpt</code> 跟我说：</p><blockquote><p>可以通过 <code>git branch --contains &lt;commit-id></code> 这个命令来实现。</p></blockquote><p>很明显这个命令不是我想要的，我需要是精确匹配，也就是 <code>branch-name</code> 通过 <code>git rev-parse</code> 解析后，刚好等于我指定的 <code>commit-id</code> 。于是我纠正 <code>chatgpt</code> ，让它给我提供一个可以精确匹配的方案。</p><p>于是 <code>chatgpt</code> 又给出了一个解决方案：</p><blockquote><p><code>git show-ref | grep &lt;commit-id></code></p></blockquote><p>这个方案确实可以满足我的需求，但是我总觉得不是最优解。于是我继问：</p><blockquote><p>你上面的命是可以实现的。但有没有更高效的命令，像<code>git rev-parse</code>一样直接获取。而不是需要我自己去<code>grep</code></p></blockquote><p>接着 <code>chatgpt</code> 又给出一个解决方案：</p><blockquote><p><code>git name-rev --name-only &lt;commit-id></code></p><p>如果这个 commit id 正好对应某个分支的最新 commit，这个命令会返回对应的分支名。</p><p>然而，<code>git name-rev</code> 会尝试找到最接近的引用（分支或标签）来命名 commit，因此如果 commit 不正好是某个分支的 HEAD，返回的结果可能会是一个基于最接近引用的名称（例如 <code>master~2</code> 表示 master 分支倒数第二个 commit）。
如果你需要更加精确地确定某个 commit id 是否正好对应于某个分支的 HEAD，可以使用以下命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git <span style=color:#007020;font-weight:700>for</span>-each-ref --format<span style=color:#666>=</span><span style=color:#4070a0>&#39;%(refname)&#39;</span> refs/heads/ | <span style=color:#007020;font-weight:700>while</span> <span style=color:#007020>read</span> ref; <span style=color:#007020;font-weight:700>do</span> <span style=color:#007020;font-weight:700>if</span> <span style=color:#666>[</span> <span style=color:#4070a0>&#34;</span><span style=color:#007020;font-weight:700>$(</span>git rev-parse <span style=color:#bb60d5>$ref</span><span style=color:#007020;font-weight:700>)</span><span style=color:#4070a0>&#34;</span> <span style=color:#666>=</span> <span style=color:#4070a0>&#34;&lt;commit-id&gt;&#34;</span> <span style=color:#666>]</span>; <span style=color:#007020;font-weight:700>then</span> <span style=color:#007020>echo</span> <span style=color:#bb60d5>$ref</span> <span style=color:#007020;font-weight:700>fi</span> <span style=color:#007020;font-weight:700>done</span>
</span></span></code></pre></div></blockquote><p>很明显，这个方案越来越复杂了，还不如最开始的 <code>git show-ref | grep &lt;commit-id></code> 简洁。然后我又追问 <code>chatgpt</code> ：</p><blockquote><p>脚本太复杂了，就没有更简洁的命令吗？</p></blockquote><p>最后 <code>chatgpt</code> 终于给出了我满意的答案：</p><blockquote><p>确实可以简化查询是否有分支的 HEAD 完全匹配指定的 commit ID。以下是一个更简洁的命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git branch --points-at &lt;commit-id&gt;
</span></span></code></pre></div><p>这个命令会列出所有分支，它们的 HEAD 完全匹配指定的 commit ID。</p><p>假设你的 commit ID 是 <code>abc123</code>，你可以运行以下命令：</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git branch --points-at abc123
</span></span></code></pre></div><p>这将列出所有 HEAD 指向 <code>abc123</code> 的分支。这样，你就可以直接找到那些分支的 HEAD 完全匹配特定的 commit ID，而不需要编写复杂的脚本。</p></blockquote><p>最后，我查了一下，<code>git branch --points-at</code> 替换成 <code>git tag --points-at</code> 就可以处理 <code>tag</code> 相关的查询了。</p></div><div class=page-nav><a href=/posts/git%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF%E4%B8%8E%E8%BF%9C%E7%AB%AF%E9%87%8D%E5%90%8D.html class="nav-btn page-next">git本地分支与远端重名</a>
<a href=/posts/ldconfig.html class="nav-btn page-prev">ldconfig</a></div><div class=comment style=clear:both;margin-top:5em></div></div></div></div><div class=footer><div class=copyright>@2019 <a href=https://leenzhu.com>LeenZhu</a></div><div class=powered_by>Power by <a href=http://www.gohugo.io/>Hugo</a>,
using <a href=https://github.com/leenzhu/hugo-theme-sun>Sun</a> Theme</div></div></body></html>